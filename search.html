<!DOCTYPE html> 
<html>
    <head>
        <title> </title>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="./style.css">
        <script src="./js/search.js"></script>
        <script>
            var xhr = new XMLHttpRequest();
            xhr.addEventListener('readystatechange', ajaxHandler);

            function drawCard(jsonItems, query){
                let searchList = jsonItems.searchAddr(query);
                
                for(let i in searchList){
                    let searchResult = document.createElement('div');
                    let name = document.createElement('h5');
                    let tel = document.createElement('p');
                    let addr = document.createElement('p');

                    searchResult.setAttribute('class', 'searchResult');
                    name.setAttribute('class', 'jsonName');
                    tel.setAttribute('class', 'jsonTel');
                    addr.setAttribute('class', 'jsonAddr');

                    name.innerHTML = searchList[i].name;
                    tel.innerHTML = searchList[i].tel;
                    addr.innerHTML = searchList[i].addr;

                    searchResult.setAttribute('key', i);
                    searchResult.appendChild(name);
                    searchResult.appendChild(tel);
                    searchResult.appendChild(addr);

                    if(searchList[i].geo){
                        searchResult.setAttribute('data-lat', searchList[i].geo[1]);
                        searchResult.setAttribute('data-lng', searchList[i].geo[0]);
                    }

                    searchList[i] = searchResult;
                    console.log(searchList[i]);
                }
            }

            function ajaxHandler(){
                if(xhr.readyState === 4 && xhr.status === 200){
                    const query = new URL(location.href).searchParams.get('query');
                    const jsonItems = parseBSRSJSON(xhr.responseText);
                    
                    if(query !== null){
                        drawCard(jsonItems, query);
                    }
                }
            }

            function init(){
                xhr.open('GET', 'BusanSafeRestaurantList.json', true);
                xhr.send();
            }

            window.addEventListener('load', init);
        </script>
    </head>

    <body>
        <div id="nav">
            <span class="spanTitle">
                <span class="spanMini">부심 </span>
                부산시 안심식당 정보 플랫폼 </span>
            <div class="anchor">
                <a href="#safe">안심식당이란?</a>
                <a href="#busim">부심이란?</a>
                <a href="./matzip.html" target="_blank">부심선정맛집</a>
            </div>
            <form id="searchBox" action="search.html">
                <input type="text" id="searchInput" name="query" placeholder="부산의 지역명을 입력해주세요. ex)해운대">
                <button type="submit" id="submit">검색<i class="bi bi-search"></i></button>
            </form>
        </div>

        <div class="searchList">
            <div class="searchResult">
                <h5 class="jsonName">여기에 biz_nm 삽입</h5>
                <p class="jsonTel">전화 biz_tel 삽입</p>
                <p class="jsonAddr">주소 addrs 삽입</p>
            </div>
        </div>
    </body>
</html>

